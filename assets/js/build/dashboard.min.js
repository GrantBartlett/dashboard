/*! dashboard 2014-05-21 */
$(function(){$("#change").on("click",function(){$(".ajax").load("/ajax2")})}),$(function(){var a=[];$.getJSON("http://sfmreport.api/api/v1/members/",function(b){$.each(b,function(b,c){a.push({email:c.email,username:c.username,screen_name:c.screen_name,group_id:c.group_id,join_date:c.join_date,last_activity:c.last_activity,last_visit:c.last_visit})});var c=[];$.each(a,function(a,b){c.push(b.join_date)});var d=1400595890,e=604800,f=2629743,g=_.min(c),h=_.range(g,d,e),i=_.range(g,d,f),j=[],k=[];$.each(h,function(b){_.find(a,function(a){a.join_date>=h[b]&&a.join_date<=h[b+1]&&k.push(a.username)}),j.push({week:b,count:k.length})}),console.log(j);var l=[],m=[];$.each(i,function(b){var c;_.find(a,function(a){c=i[b],a.join_date>=i[b]&&a.join_date<=i[b+1]&&m.push(a.username)}),$date=new Date(1e3*c),$date_month=$date.getMonth(),$date_year=$date.getYear(),l.push({month_name:$date_month+"/"+$date_year,count:m.length})});var n=[],o=[];$.each(l,function(a){o.push(l[a].month_name),n.push(l[a].count)});var p=document.getElementById("myChart").getContext("2d"),b={labels:o,datasets:[{fillColor:"rgba(220,220,220,0.5)",strokeColor:"rgba(220,220,220,1)",pointColor:"rgba(220,220,220,1)",pointStrokeColor:"#fff",data:n}]};new Chart(p).Line(b);var q=[],r=[];$.each(i,function(b){var c,d=0;_.find(a,function(a){c=i[b],a.join_date>=i[b]&&a.join_date<=i[b+1]&&(r.push(a.username),d++)}),$date=new Date(1e3*c),$date_month=$date.getMonth(),$date_year=$date.getFullYear(),q.push({month_name:$date_month+"/"+$date_year,count:d})});var s=[],t=[];$.each(l,function(a){t.push(q[a].month_name),s.push(q[a].count)});var u=document.getElementById("myChart2").getContext("2d"),v={labels:t,datasets:[{fillColor:"rgba(220,220,220,0.2)",strokeColor:"rgba(220,220,220,1)",pointColor:"rgba(220,220,220,1)",pointStrokeColor:"#fff",data:n},{fillColor:"rgba(151,187,205,0.5)",strokeColor:"rgba(151,187,205,1)",pointColor:"rgba(151,187,205,1)",pointStrokeColor:"#fff",data:s}]};new Chart(u).Line(v),console.log(q)})});